<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirector</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',Helvetica,Arial;margin:0;padding:24px;background:#0f172a;color:#e6eef8}
    .card{background:#0b1220;padding:18px;border-radius:12px;max-width:820px;margin:16px auto;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    h1{margin:0 0 8px;font-size:20px}
    p{margin:6px 0 12px;color:#9fb0d6}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px 6px;text-align:left;border-bottom:1px solid rgba(255,255,255,.04)}
    a.link{color:#9cf;text-decoration:underline}
    .btn{display:inline-block;padding:6px 10px;border-radius:8px;background:#1e293b;color:#fff;text-decoration:none;font-size:13px}
    .small{font-size:13px;color:#9fb0d6}
    .alert{color:#ffd4a3}
    input.copy{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:inherit}
  </style>
</head>
<body>
  <div class="card" id="main">
    <h1>Static Redirector</h1>
    <div id="status" class="small"></div>
    <div id="list"></div>
  </div>

<script>
const MAPPINGS = {
  "default": "https://example.com",
  "demo1": "https://www.youtube.com/playlist?list=PLkV0VM91GAUvKjbcyRevrDsJgeuXgG_6I",
};


function getPurposeFromLocation() {
  const path = decodeURIComponent(location.pathname || "/").replace(/^\/+|\/+$/g,''); // trim slashes
  if (path) return path.split('/')[0];

  const qp = new URLSearchParams(location.search).get('p');
  if (qp) return qp;

  const h = (location.hash || "").replace(/^#/, '');
  if (h) return h;

  return null;
}

function buildRedirectUrl(purpose) {
  if (MAPPINGS.hasOwnProperty(purpose)) return MAPPINGS[purpose];
  if ((!purpose || purpose === "") && MAPPINGS.default) return MAPPINGS.default;
  return null;
}

function showListAndControls(foundPurpose) {
  const list = document.getElementById('list');
  list.innerHTML = '';

  const info = document.createElement('div');
  info.innerHTML = `<p class="small">현재 URL: <code>${location.href}</code></p>`;
  list.appendChild(info);

  const tbl = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>purpose</th><th>target URL</th><th>QR / 링크 복사</th></tr>';
  tbl.appendChild(thead);
  const tbody = document.createElement('tbody');

  const base = location.origin + location.pathname.replace(/\/?[^\/]*$/, '/'); // base for query/hash links
  const originHost = location.origin + location.pathname.replace(/\/?[^\/]*$/, '');

  for (const key of Object.keys(MAPPINGS)) {
    const tr = document.createElement('tr');
    const tdKey = document.createElement('td');
    tdKey.textContent = key;
    const tdUrl = document.createElement('td');
    tdUrl.innerHTML = `<a class="link" href="${MAPPINGS[key]}" target="_blank" rel="noopener">${MAPPINGS[key]}</a>`;
    const tdAction = document.createElement('td');

    // 1) link using query ?p=key
    const linkQuery = location.origin + location.pathname + '?p=' + encodeURIComponent(key);
    // 2) link using path (works if file is put to 404.html)
    const linkPath = location.origin + '/' + encodeURIComponent(key);
    // 3) hash link
    const linkHash = location.origin + location.pathname + '#' + encodeURIComponent(key);

    tdAction.innerHTML = `
      <div class="small">?p: <input class="copy" readonly value="${linkQuery}" /></div>
      <div class="small">path: <input class="copy" readonly value="${linkPath}" /></div>
      <div class="small">#hash: <input class="copy" readonly value="${linkHash}" /></div>
      <div style="margin-top:6px"><a class="btn" href="${linkQuery}">테스트 링크</a></div>
    `;

    tr.appendChild(tdKey);
    tr.appendChild(tdUrl);
    tr.appendChild(tdAction);
    tbody.appendChild(tr);
  }
  tbl.appendChild(tbody);
  list.appendChild(tbl);

  // copy-on-click for inputs
  list.querySelectorAll('input.copy').forEach(inp=>{
    inp.addEventListener('click', ()=>{ inp.select(); document.execCommand('copy'); const orig = inp.value; const old = inp.style.background; inp.style.background = "#18304a"; setTimeout(()=>inp.style.background = old,300); });
  });

  // show helpful note
  const note = document.createElement('p');
  note.className = 'small';
  note.innerHTML = '<span class="alert">팁:</span> GitHub Pages에서 경로 기반 리다이렉트(예: <code>yourname.github.io/shop</code>)를 사용하려면 이 파일을 레포 루트에 <code>404.html</code>로 올려야 합니다. QR에는 위의 <code>?p=</code> 또는 <code>path</code> 링크 중 하나를 넣으면 됩니다.';
  list.appendChild(note);
}

(function startup(){
  const status = document.getElementById('status');
  const purpose = getPurposeFromLocation();

  if (purpose) {
    status.innerHTML = `<strong>목적 감지:</strong> <code>${purpose}</code> — 매핑 확인 중...`;
    const target = buildRedirectUrl(purpose);
    if (target) {
      status.innerHTML += `<br><span class="small">리다이렉트 중... (${target})</span>`;
      setTimeout(()=>{ location.replace(target); }, 250);
      return;
    } else {
      status.innerHTML += `<br><span class="alert">매핑을 찾을 수 없습니다: "${purpose}"</span>`;
      showListAndControls(purpose);
      return;
    }
  } else {
    status.innerHTML = `<strong>목적이 지정되지 않았습니다.</strong> 아래 목록에서 목적을 골라 QR/링크를 복사하세요. (또는 URL에 <code>?p=purpose</code> 또는 <code>#purpose</code>를 붙이세요.)`;
    showListAndControls(null);
  }
})();
</script>
</body>
</html>

