# Kotlin에서 null을? [예외를 던지지 않고 null을 반환하는 이유]

## 서론

로또 미션을 수행하면서 kotlin에서 예외 처리를 하는 방법에 대해 읽게 되었다. 내용은 아래와 같은데, 논리적인 오류가 아니면 예외를 던지지 말고 null을 반환한다는 구문에서 의문이 생겼고, 그 고민 과정을 공유하고자 한다.

![Untitled](articles/images/1/Untitled.png)

---

### 맨 처음 든 생각

1. null을 쓰는 이유는?
    1. kotlin에서는 nullable과 not nullable을 구별해서 쓸 만큼 null 사용을 지양하는 것으로 이해하고 있다. 그런데 굳이 예외를 던지지 않고 null을 사용해서 처리하는 방식이 이해되지 않았다.
2. 그렇다면 논리적인 오류일때도 null을 던지면 안될까?

---

### 내가 생각했던 null

- NullPointerException을 야기하는 골칫덩이
- Kotlin에서는 사용할 일도, 생각할 일도 (거의) 없는 개념

---

### Java에서, Kotlin에서의 null

Type. 타입은 행동 (메소드)와 상태 (필드)를 합친 개념이다. 따라서 특정 타입의 인스턴스는 상태를 가지고 행동을 할 때 상태에 따라 다른 결과를 돌려준다.

예를 들어, 아래와 같은 코드는 Int 타입의 인스턴스 i가 존재하고, plus(2) 라는 행동을 해 현재 상태 3에 따라 5라는 결과가 나온다.

```kotlin
var i: Int = 3
print(i + 2) // 5
```

그러나 다른 타입 끼리는 연산이 불가능하다.

```kotlin
var i: Int = 3
var s: String = "2"
print(i + s) // compile error
```

객체지향 언어에서 null은 어떠한 상태와 행동 둘 다 가지지 않는 값을 의미한다.

그러나 java의 경우 모든 타입의 변수에 null을 대입 가능하다. 개발자가 어떤 상태와 행동을 할 것이라고 예상하고 있던 변수가 생각대로 작동 하지 않을 가능성이 높다는 뜻이다. 이는 근본적으로 비정상적인 설계인 것이다.

자바 개발자들은 이를 해결하기 위해 여러 방법을 사용하고 있으며 Optional<T>를 이용하는 방법도 있다. 타입을 감싸는 래핑 클래스로 변수를 선언하고 사용하는 방식이다. 이는 지저분한 코드와 성능 저하를 야기한다.

```java
// Optional의 value는 값이 있을 수도 있고 null 일 수도 있다.
Optional<String> optional = Optional.ofNullable(getName());
String name = optional.orElse("anonymous"); // 값이 없다면 "anonymous" 를 리턴
```

그래서 kotlin은 기본적으로 null을 불허하고 있다. null에 대한 접근을 런타임에서 컴파일 타임으로 옮기는 것이다. 이를 구현하기 위해 nullable type이라는 개념을 도입한 것이다.

nullable type의 메서드 호출이나 여러 행동은 컴파일 타임에 제약이 되므로 개발자는 안전한 코드 작성이 가능하다.

```kotlin
fun strLenSafe(s: String?) = s.length() // compile error
```

또한 런타임에서는 nullable과 not nullable 모두 동일한 타입으로 간주되므로 성능 저하도 발생하지 않는다.

### 그렇다면 왜 null을 사용하는가?

위 내용을 읽었을때 null은 바보같은 개념같지만, 아무 상태도 가지고 있지 않고 아무 행동도 하지 않는다는 강력한 표현이 될 수 있다.

예를 들어 List의 getOrNull() 같은 확장 함수를 생각 할 수 있다. index에 해당하는 원소가 있는지 검사하고, 없다면 예외를 발생시키는 것이 아닌 값이 없음을 나타내는 명시적인 표현인 null을 반환하는 것이다. 이를 통해 개발자는 null인지 검사만 함으로써 의도한 동작이 실행되었는지 알 수 있다.

그렇지 않고 null을 피하기 위해 -1, 0 같은 값을 반환한다면 다른 개발자는 명확한 값이 없을 때 어떤 값을 반환하는지 문서를 확인해가며 코드를 작성해야 할 것이다.

---

### 논리적 오류가 아닐 때도 예외 처리를 하면 안될까! 반대로 논리적 오류일 때도 null을 던지면 안될까?

그렇다면 위와 같은 의문이 생길 수도 있다.

먼저 여기서 논리적 오류가 무엇인지 생각해보자. 로또 번호를 생성할 때 우리는 1에서 45 사이의 숫자를 가져야 한다는 제약 조건을 가진다. 그런데 이때 0이나 46 등의 값을 생성하면 우리는 이것을 오류라고 생각 할 수 있다. 이와 같이 도메인에서 요구하는 로직에 부합하지 않은 동작을 논리적 오류라고 생각 할 수 있다.

먼저 논리적 오류일때 null을 반환하면 어떤 문제가 생길까? 우리는 어떤 이유 때문에 오류가 발생했고 어디서 발생했는지 알고 싶은데 이러한 정보를 알 길이 없어진다. 이때는 예외를 던지는게 합당하다고 볼 수 있다.

그럼 반대로 논리적 오류가 아닐 때 예외를 처리하면 어떨까? 직접적인 문제는 생기지 않을 수 있다. 하지만 이때 생기는 문제를 처리하기 위해 우리는 null check로 간단히 해결 할 수 있는 로직을 try catch 구문을 사용해 감싸주어야 한다. 또한 위에서 설명했듯이 null이라는 명시적인 표현을 사용하지 않는 또다른 논리적 오류가 발생한다.